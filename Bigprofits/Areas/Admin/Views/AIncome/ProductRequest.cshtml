@using System.Data
@model DataSet
@using Bigprofits.Common;
@using Microsoft.Extensions.Configuration;
@{
    int SrNo = 1;
    Layout = "_AALayout";
    var configuration = Context.RequestServices.GetService(typeof(IConfiguration)) as IConfiguration;
    CommonMethods lib = new CommonMethods(configuration!);
}
<style>
    #backToTopBtn {
        display: block; /* Hidden by default */
        position: fixed; /* Fixed/sticky position */
        bottom: 20px; /* Place the button at the bottom of the page */
        right: 20px; /* Place the button 30px from the right */
        z-index: 99; /* Make sure it does not overlap */
        color: white; /* Text color */
        cursor: pointer; /* Add a mouse pointer on hover */
        font-size: 24px; /* Increase font size */
        border-radius: 5px; /* Rounded corners */
        transition: background-color 0.3s, box-shadow 0.3s; /* Smooth transition for background and shadow */
    }

        #backToTopBtn:hover {
            box-shadow: 0 0 15px 5px rgba(255, 255, 255, 1.6);
        }
    /* Media query for mobile devices */
    @@media (max-width: 768px) {
        #backToTopBtn {
            display: block; /* Show the button on mobile */
        }
    }

    #searchInput {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background-color: rgba(0, 0, 0, 0.15);
    }

        /* Placeholder text color */
        #searchInput::placeholder {
            color: black;
        }

        /* Hover effect */
        #searchInput:hover {
            border-color: #66afe9;
        }

        /* Focus effect */
        #searchInput:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
        }

    .styled-table {
        border-collapse: collapse;
        margin: 25px 0;
        padding: 20px;
        font-size: 0.9em;
        font-family: sans-serif;
        min-width: 400px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.25);
        border-radius: 12px; /* Added border radius */
        overflow: hidden; /* To apply border radius properly */
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        border-radius: 5px;
    }

    th, td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    th {
        background-color: rgba(0, 0, 0, 0.15);
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        color: darkslateblue;
        font-weight: normal;
    }

    tr:hover {
        background-color: rgba(10, 5, 5, 0.15);
        transition: background-color 0.3s ease;
    }

    .fa-edit {
        color: blue;
    }
</style>

@if (TempData["msg"] != null)
{
    <div class="alert alert-success" role="alert">
        @TempData["msg"]
    </div>
}
@if (TempData["rej"] != null)
{
    <div class="alert alert-danger" role="alert">
        <span style="color:lime">Success!!@TempData["rej"]</span>
    </div>
}
<div class="row">
    <div class="col-md-12 mb-2 innerLinkWrap">
        <div class="btn btn-secondary innerLink">
            <a href="/britglbl253adpnl/add-product">
                <div class="card-body p-2 text-center">
                    <h6 class="text-dark mb-0">Add Products</h6>
                </div>
            </a>
        </div>
        <div class="btn btn-secondary innerLink">
            <a href="/britglbl253adpnl/product-list">
                <div class="card-body p-2 text-center">
                    <h6 class="text-dark mb-0">Products list</h6>
                </div>
            </a>
        </div>
        <div class="btn btn-secondary innerLink active">
            <a href="/britglbl253adpnl/product-request">
                <div class="card-body p-2 text-center">
                    <h6 class="text-dark mb-0">Products Request</h6>
                </div>
            </a>
        </div>
        <div class="btn btn-secondary innerLink">
            <a href="/britglbl253adpnl/product-history">
                <div class="card-body p-2 text-center">
                    <h6 class="text-dark mb-0">Product History</h6>
                </div>
            </a>
        </div>
    </div>
</div>
<div>


    @if (Model.Tables[0].Rows.Count > 0)
    {
        <table class="styled-table" style="color:black">
            <thead>
                <tr>
                    <th>Sr.No</th>
                    <th>Member</th>
                    <th>By Member</th>
                    <th>Order Id</th>
                    <th>Total Products</th>
                    <th>Items</th>
                    <th>Total Price</th>
                    <th>Total GST</th>
                    <th>Final Amount</th>
                    <th>Order Status</th>
                    <th>Request Date</th>
                    <th>Approved Date</th>
                    <th colspan="3"><center>Actions</center></th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                @foreach (DataRow agent in Model.Tables[0].Rows)
                {

                    <tr>
                        <td>@SrNo</td>
                        <td>@lib.Decrypt(agent["memMobile"].ToString()!) / @agent["memName"]</td>
                        <td>@lib.Decrypt(agent["ByMemMobile"].ToString()!) / @agent["ByMemName"]</td>
                        <td>@agent["OrderId"]</td>
                        <td>@agent["Total_Products"]</td>
                        <td>@agent["Items"]</td>
                        <td>@string.Format("{0:0.00}", agent["Total_Price"])</td>
                        <td>@string.Format("{0:0.00}", agent["Total_Gst"])</td>
                        <td>@string.Format("{0:0.00}", agent["Final_Amount"])</td>
                        @if (agent["Order_Status"].ToString() == "0")
                        {
                            <td>
                                <i style="color:orange" class="fas fa-circle"></i>
                                Pending
                            </td>
                        }

                        <td>@agent["Request_Date"]</td>
                        <td>@agent["Approved_Date"]</td>
                        <td>
                            <a href="/britglbl253adpnl/update-product-request?OrderId=@agent["OrderId"]" onclick="return confirm('Are you sure? You want to Approve This Order')">
                                <i style="color:limegreen" class="fa fa-check-circle"></i>Approve
                            </a>
                        </td>
                        <td>
                            <a href="@Url.Action("requested-product-details","britglbl253adpnl", new { OrderId = agent["OrderId"] })"><i class="fas fa-info"></i>Info</a>
                        </td>

                        @* <td>
                <a href="/britglbl253adpnl/reject-product-request?OrderId=@agent.OrderId" onclick="return confirm('Are you sure? You want to Reject This Order')">
                <i style="color:red" class="fas fa-times-circle"></i>Reject
                </a>
                </td> *@
                    </tr>
                    SrNo++;
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-danger">No Product Request Found</p>
    }
</div>
<a href="#" id="backToTopBtn" title="Go to top">⬆️</a>

@section Scripts {
    <script>
        var Model = @Html.Raw(ViewBag.Model);
        $('#searchInput').on('input', function () {
            var searchText = $(this).val();

            var filteredProducts = Model.filter(function (product) {
                return product.OrderId.includes(searchText);
            });

            renderFilteredProducts(filteredProducts);
        });
        console.log(Model);
        function renderFilteredProducts(products) {


            var prodHtml = "";
            products.forEach((product, index) => {
                prodHtml += `<tr>
                                                                                                                                                                                                                                                                             <td>${index + 1}</td>
                                                                                                                                                                                                                                                                            <td>${product.Memberid}</td>
                                                                                                                                                                                                                                                                            <td>${product.OrderId}</td>
                                                                                                                                                                                                                                                                            <td>${product.TotalProducts}</td>
                                                                                                                                                                                                                                                                            <td>${product.Items}</td>
                                                                                                                                                                                                                                                                            <td>${product.TotalPrice.toFixed(2)}</td>
                                                                                                                                                                                                                                                                            <td>${product.TotalGst}</td>
                                                                                                                                                                                                                                                                            <td>${product.FinalAmount}</td>
                                                                                                                                                                                                                                                                            <td>${product.OrderStatus}</td>
                                                                                                                                                                                                                                                                            <td>${product.RequestDate}</td>
                                                                                                                                                                                                                                                                             <td>
                                                                                                                                                                                                                                                                              <a href="/britglbl253adpnl/requested-product-details/${product.OrderId}"><i class="fas fa-info"></i>Details</a>
                                                                                                                                                                                                                                                                             </td>
                                                                                                                                                                                                                                                                             </tr>`;
            });
            $("#productTableBody").html(prodHtml)
        }
    </script>
}
